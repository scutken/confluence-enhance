!function(){"use strict";window.VditorToggle||(window.VditorToggle={init:function(){document.addEventListener("DOMContentLoaded",function(){VditorToggle.setup()})},showSvgModal:null,createRequiredElements:function(e){const t=document.createElement("div");t.className="vditor-toggle-container";const n=document.createElement("button");n.id="toggleVditorBtn",n.className="vditor-toggle-btn",n.textContent="显示 Markdown 渲染";const o=document.createElement("div");return o.id="vditor-content",t.appendChild(n),e.parentNode.insertBefore(t,e),e.parentNode.insertBefore(o,e.nextSibling),{vditorContainer:o,toggleBtn:n,toggleContainer:t}},setup:function(){const e=document.querySelector(".conf-macro.output-block[data-macro-name='noformat']");if(!e)return void console.warn("VditorToggle: 未找到Confluence markdown内容块");const t=e.textContent.trim();if(!t)return void console.warn("VditorToggle: markdown内容为空");const{vditorContainer:n,toggleBtn:o,toggleContainer:i}=this.createRequiredElements(e);let s=!0,l=!0;function r(e,t){t.innerHTML="";const n=document.createElement("h3");n.textContent="文档大纲",t.appendChild(n);const o=e.querySelectorAll("h1, h2, h3, h4, h5, h6");if(0===o.length){const e=document.createElement("p");return e.textContent="暂无大纲",e.style.color="#6a737d",e.style.fontStyle="italic",void t.appendChild(e)}const i=function(e){const t=[],n=[];return e.forEach((e,o)=>{const i=parseInt(e.tagName.charAt(1)),s=e.textContent.trim(),l=e.id||`heading-${o}`;e.id||(e.id=l);const r={level:i,text:s,id:l,element:e,children:[]};for(;n.length>0&&n[n.length-1].level>=i;)n.pop();0===n.length?t.push(r):n[n.length-1].children.push(r),n.push(r)}),t}(o),s=d(i);t.appendChild(s),function(e,t){let n=!1;function o(){const o=window.innerHeight;let i=null,s=1/0;e.forEach(e=>{const t=e.getBoundingClientRect(),n=Math.abs(t.top);t.top<=.3*o&&n<s&&(s=n,i=e)});if(t.querySelectorAll(".outline-link").forEach(e=>{e.classList.remove("active"),e.style.backgroundColor="",e.style.color="#586069"}),i){const e=t.querySelector(`[data-target-id="${i.id}"]`);e&&(e.classList.add("active"),e.style.backgroundColor="#0366d6",e.style.color="white")}n=!1}function i(){n||(requestAnimationFrame(o),n=!0)}window.addEventListener("scroll",i,{passive:!0}),o()}(o,t)}function d(e,t=0){const n=document.createElement("ul");return n.style.cssText="\n          margin: 0;\n          padding: 0;\n          list-style: none;\n        ",e.forEach(e=>{const o=document.createElement("li");o.style.margin="2px 0";const i=document.createElement("div");if(i.style.cssText=`\n            display: flex;\n            align-items: center;\n            margin-left: ${12*t}px;\n          `,e.children.length>0){const e=document.createElement("span");e.className="outline-toggle",e.innerHTML="▼",e.style.cssText="\n              width: 12px;\n              height: 12px;\n              margin-right: 4px;\n              cursor: pointer;\n              font-size: 10px;\n              color: #586069;\n              transition: transform 0.2s ease;\n              user-select: none;\n            ",i.appendChild(e)}else{const e=document.createElement("span");e.style.cssText="width: 16px; height: 12px; margin-right: 0px;",i.appendChild(e)}const s=document.createElement("a");if(s.href=`#${e.id}`,s.textContent=e.text,s.className="outline-link",s.setAttribute("data-target-id",e.id),s.style.cssText="\n            display: block;\n            padding: 2px 8px;\n            color: #586069;\n            text-decoration: none;\n            border-radius: 3px;\n            font-size: 13px;\n            line-height: 1.4;\n            flex: 1;\n            transition: all 0.2s ease;\n          ",s.addEventListener("mouseenter",function(){this.style.backgroundColor="#f6f8fa",this.style.color="#0366d6"}),s.addEventListener("mouseleave",function(){this.classList.contains("active")||(this.style.backgroundColor="",this.style.color="#586069")}),s.addEventListener("click",function(t){t.preventDefault();const n=document.getElementById(e.id);n&&n.scrollIntoView({behavior:"smooth",block:"start"})}),i.appendChild(s),o.appendChild(i),e.children.length>0){const n=d(e.children,t+1);n.className="outline-children",o.appendChild(n);i.querySelector(".outline-toggle").addEventListener("click",function(){const e="none"===n.style.display;n.style.display=e?"block":"none",this.style.transform=e?"rotate(0deg)":"rotate(-90deg)"})}n.appendChild(o)}),n}function c(e){const t=document.createElement("div");t.className="svg-modal",t.style.cssText="\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: rgba(0, 0, 0, 0.8);\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          z-index: 10000;\n          overflow: hidden;\n        ";const n=document.createElement("div");n.style.cssText="\n          position: relative;\n          width: 90%;\n          height: 90%;\n          overflow: hidden;\n          background: white;\n          border-radius: 8px;\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n          cursor: grab;\n        ";const o=e.cloneNode(!0);o.style.cssText="\n          width: 100%;\n          height: 100%;\n          object-fit: contain;\n          transition: transform 0.1s ease;\n          transform-origin: center center;\n          pointer-events: auto;\n        ",n.appendChild(o);const i=document.createElement("button");i.innerHTML='\n          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>\n            <path d="M21 3v5h-5"/>\n            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>\n            <path d="M3 21v-5h5"/>\n          </svg>\n        ',i.title="重置视图 (恢复到原始大小和位置)",i.style.cssText="\n          position: absolute;\n          bottom: 20px;\n          right: 20px;\n          width: 48px;\n          height: 48px;\n          border: 2px solid rgba(255, 255, 255, 0.3);\n          border-radius: 50%;\n          background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95));\n          color: #475569;\n          font-size: 0;\n          cursor: pointer;\n          z-index: 10002;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);\n          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n          backdrop-filter: blur(8px);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          outline: none;\n        ",i.addEventListener("mouseenter",function(){this.style.background="linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(248, 250, 252, 1))",this.style.transform="scale(1.1) translateY(-2px)",this.style.boxShadow="0 8px 20px rgba(0, 0, 0, 0.2), 0 4px 8px rgba(0, 0, 0, 0.15)",this.style.borderColor="rgba(255, 255, 255, 0.5)",this.style.color="#334155"}),i.addEventListener("mouseleave",function(){this.style.background="linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.95))",this.style.transform="scale(1) translateY(0)",this.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1)",this.style.borderColor="rgba(255, 255, 255, 0.3)",this.style.color="#475569"}),i.addEventListener("mousedown",function(){this.style.transform="scale(1.05) translateY(-1px)"}),i.addEventListener("mouseup",function(){this.style.transform="scale(1.1) translateY(-2px)"}),i.addEventListener("focus",function(){this.blur()}),i.addEventListener("keydown",function(e){e.preventDefault()}),n.appendChild(i),t.appendChild(n);let s=1,l=!1,r=0,d=0,c=0,a=0;function u(){o.style.transform=`translate(${c}px, ${a}px) scale(${s})`}i.addEventListener("click",function(e){e.stopPropagation(),s=1,c=0,a=0,u(),n.style.cursor="grab"}),n.addEventListener("wheel",function(e){e.preventDefault();const t=e.deltaY>0?.9:1.1,o=s*t;if(o>=.5&&o<=5){const t=n.getBoundingClientRect(),i=e.clientX-t.left,l=e.clientY-t.top,r=i-t.width/2,d=l-t.height/2,h=(r-c)/s,p=(d-a)/s;s=o,c=r-h*s,a=d-p*s,u()}}),o.addEventListener("dblclick",function(e){if(e.preventDefault(),e.stopPropagation(),1===s){const t=n.getBoundingClientRect(),o=e.clientX-t.left,i=e.clientY-t.top,l=t.width/2,r=t.height/2;s=2,c=-(o-l),a=-(i-r)}else s=1,c=0,a=0;u()}),n.addEventListener("mousedown",function(e){e.target!==o&&e.target!==n||(l=!0,r=e.clientX-c,d=e.clientY-a,n.style.cursor="grabbing",e.preventDefault())}),document.addEventListener("mousemove",function(e){l&&(c=e.clientX-r,a=e.clientY-d,u())}),document.addEventListener("mouseup",function(){l&&(l=!1,n.style.cursor="grab")});let h=0,p=1;function g(){t.parentNode&&document.body.removeChild(t)}n.addEventListener("touchstart",function(e){if(2===e.touches.length){const t=e.touches[0],n=e.touches[1];h=Math.hypot(n.clientX-t.clientX,n.clientY-t.clientY),p=s}else if(1===e.touches.length){l=!0;const t=e.touches[0];r=t.clientX-c,d=t.clientY-a}e.preventDefault()}),n.addEventListener("touchmove",function(e){if(2===e.touches.length){const t=e.touches[0],n=e.touches[1],o=Math.hypot(n.clientX-t.clientX,n.clientY-t.clientY),i=p*(o/h);i>=.5&&i<=5&&(s=i,u())}else if(1===e.touches.length&&l){const t=e.touches[0];c=t.clientX-r,a=t.clientY-d,u()}e.preventDefault()}),n.addEventListener("touchend",function(){l=!1}),t.addEventListener("click",function(e){e.target===t&&g()});const m=function(e){"Escape"===e.key&&(g(),document.removeEventListener("keydown",m))};document.addEventListener("keydown",m);const f=document.createElement("button");f.innerHTML="×",f.style.cssText="\n          position: absolute;\n          top: 10px;\n          right: 10px;\n          width: 30px;\n          height: 30px;\n          border: none;\n          background: rgba(255, 255, 255, 0.9);\n          color: #333;\n          font-size: 20px;\n          font-weight: bold;\n          border-radius: 50%;\n          cursor: pointer;\n          z-index: 10001;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        ",f.addEventListener("click",function(){g()}),t.appendChild(f),document.body.appendChild(t)}function a(){if(t&&!n.hasChildNodes()){const e=document.getElementById("vditor-outline")||function(){const e=document.createElement("div");return e.id="vditor-outline",e.className="vditor-outline",e.style.cssText="\n          position: fixed;\n          top: 30vh;\n          right: 20px;\n          width: 200px;\n          max-height: 65vh;\n          overflow-y: auto;\n          background: #fff;\n          border: 1px solid #e1e4e8;\n          border-radius: 6px;\n          padding: 10px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          z-index: 1000;\n          font-size: 14px;\n          display: none;\n        ",document.body.appendChild(e),e}();Vditor.preview(n,t,{markdown:{toc:!0,mark:!0,footnotes:!0,autoSpace:!0},math:{engine:"KaTeX",inlineDigit:!0},hljs:{style:"github",lineNumber:!0},mermaid:{enable:!0,theme:"default",cdn:"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"},anchor:2,lang:"zh_CN",theme:{current:"light"},after:function(){setTimeout(()=>{r(n,e),e.style.display="block"},100),setTimeout(()=>{var e;(e=n).querySelectorAll(".language-mermaid").forEach(t=>{t.querySelectorAll("svg").forEach(n=>{if(n.hasAttribute("data-zoom-enabled"))return;n.setAttribute("data-zoom-enabled","true"),t.style.cssText+="\n              text-align: center;\n              margin: 12px auto;\n              width: 90%;\n              max-width: 900px;\n              min-width: 300px;\n            ";const o=n.getBoundingClientRect(),i=n.viewBox?.baseVal?.width||o.width||n.width?.baseVal?.value||800;let s=(n.viewBox?.baseVal?.height||o.height||n.height?.baseVal?.value||600)*((t.clientWidth||.9*e.clientWidth)/i);s>600&&(s=600),n.style.cssText+=`\n              width: 100%;\n              height: ${s}px;\n              max-height: 600px;\n              border: 1px solid #e1e4e8;\n              border-radius: 6px;\n              background: white;\n              cursor: zoom-in;\n              transition: transform 0.2s ease, box-shadow 0.2s ease;\n              display: block;\n              object-fit: contain;\n            `,n.addEventListener("mouseenter",function(){this.style.transform="scale(1.02)",this.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)"}),n.addEventListener("mouseleave",function(){this.style.transform="scale(1)",this.style.boxShadow="none"}),n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),c(this)}),n.title="点击放大查看"})})},300)}})}}function u(){const e=document.getElementById("vditor-outline"),t=document.getElementById("outlineSwitch");e&&t&&(l=t.checked,e.style.display=l?"block":"none")}if(e){const t=function(){const e=document.createElement("div");e.className="vditor-outline-switch",e.style.display="none";const t=document.createElement("input");t.type="checkbox",t.id="outlineSwitch",t.checked=!0;const n=document.createElement("span");n.className="switch-slider";const o=document.createElement("label");return o.htmlFor="outlineSwitch",o.textContent="大纲",e.appendChild(o),e.appendChild(t),e.appendChild(n),e}();i.appendChild(t),o.addEventListener("click",function(){const t=document.getElementById("vditor-outline"),i=document.querySelector(".vditor-outline-switch");s=!s,s?(e.style.display="none",n.style.display="block",o.textContent="显示原文",o.style.backgroundColor="#6c757d",i&&(i.style.display="inline-flex"),t&&l&&(t.style.display="block"),a()):(n.style.display="none",e.style.display="",o.textContent="显示预览",o.style.backgroundColor="#007bff",t&&(t.style.display="none"),i&&(i.style.display="none"))});const r=document.getElementById("outlineSwitch"),d=t.querySelector(".switch-slider"),c=t.querySelector("label");r&&r.addEventListener("change",u),d&&d.addEventListener("click",function(){r.checked=!r.checked,u()}),c&&c.addEventListener("click",function(){r.checked=!r.checked,u()}),e.style.display="none",n.style.display="block",o.textContent="显示原文",o.style.backgroundColor="#6c757d",t.style.display="inline-flex",a()}else o.style.display="none";window.VditorToggle.showSvgModal=c}},VditorToggle.init())}();
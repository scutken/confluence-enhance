!function(){"use strict";window.VditorToggle||(window.VditorToggle={init:function(){document.addEventListener("DOMContentLoaded",function(){VditorToggle.setup()})},setup:function(){const e=document.querySelector(".conf-macro.output-block[data-macro-name='noformat']"),t=document.getElementById("vditor-content"),n=document.getElementById("toggleVditorBtn"),o=e?e.textContent.trim():"";let i=!0,l=!0;function s(e,t){t.innerHTML="";const n=document.createElement("h3");n.textContent="文档大纲",t.appendChild(n);const o=e.querySelectorAll("h1, h2, h3, h4, h5, h6");if(0===o.length){const e=document.createElement("p");return e.textContent="暂无大纲",e.style.color="#6a737d",e.style.fontStyle="italic",void t.appendChild(e)}const i=function(e){const t=[],n=[];return e.forEach((e,o)=>{const i=parseInt(e.tagName.charAt(1)),l=e.textContent.trim(),s=e.id||`heading-${o}`;e.id||(e.id=s);const c={level:i,text:l,id:s,element:e,children:[]};for(;n.length>0&&n[n.length-1].level>=i;)n.pop();0===n.length?t.push(c):n[n.length-1].children.push(c),n.push(c)}),t}(o),l=c(i);t.appendChild(l),function(e,t){let n=!1;function o(){const o=window.innerHeight;let i=null,l=1/0;e.forEach(e=>{const t=e.getBoundingClientRect(),n=Math.abs(t.top);t.top<=.3*o&&n<l&&(l=n,i=e)});if(t.querySelectorAll(".outline-link").forEach(e=>{e.classList.remove("active"),e.style.backgroundColor="",e.style.color="#586069"}),i){const e=t.querySelector(`[data-target-id="${i.id}"]`);e&&(e.classList.add("active"),e.style.backgroundColor="#0366d6",e.style.color="white")}n=!1}function i(){n||(requestAnimationFrame(o),n=!0)}window.addEventListener("scroll",i,{passive:!0}),o()}(o,t)}function c(e,t=0){const n=document.createElement("ul");return n.style.cssText="\n          margin: 0;\n          padding: 0;\n          list-style: none;\n        ",e.forEach(e=>{const o=document.createElement("li");o.style.margin="2px 0";const i=document.createElement("div");if(i.style.cssText=`\n            display: flex;\n            align-items: center;\n            margin-left: ${12*t}px;\n          `,e.children.length>0){const e=document.createElement("span");e.className="outline-toggle",e.innerHTML="▼",e.style.cssText="\n              width: 12px;\n              height: 12px;\n              margin-right: 4px;\n              cursor: pointer;\n              font-size: 10px;\n              color: #586069;\n              transition: transform 0.2s ease;\n              user-select: none;\n            ",i.appendChild(e)}else{const e=document.createElement("span");e.style.cssText="width: 16px; height: 12px; margin-right: 0px;",i.appendChild(e)}const l=document.createElement("a");if(l.href=`#${e.id}`,l.textContent=e.text,l.className="outline-link",l.setAttribute("data-target-id",e.id),l.style.cssText="\n            display: block;\n            padding: 2px 8px;\n            color: #586069;\n            text-decoration: none;\n            border-radius: 3px;\n            font-size: 13px;\n            line-height: 1.4;\n            flex: 1;\n            transition: all 0.2s ease;\n          ",l.addEventListener("mouseenter",function(){this.style.backgroundColor="#f6f8fa",this.style.color="#0366d6"}),l.addEventListener("mouseleave",function(){this.classList.contains("active")||(this.style.backgroundColor="",this.style.color="#586069")}),l.addEventListener("click",function(t){t.preventDefault();const n=document.getElementById(e.id);n&&n.scrollIntoView({behavior:"smooth",block:"start"})}),i.appendChild(l),o.appendChild(i),e.children.length>0){const n=c(e.children,t+1);n.className="outline-children",o.appendChild(n);i.querySelector(".outline-toggle").addEventListener("click",function(){const e="none"===n.style.display;n.style.display=e?"block":"none",this.style.transform=e?"rotate(0deg)":"rotate(-90deg)"})}n.appendChild(o)}),n}function d(e){e.querySelectorAll(".language-mermaid").forEach(t=>{t.querySelectorAll("svg").forEach(n=>{if(n.hasAttribute("data-zoom-enabled"))return;n.setAttribute("data-zoom-enabled","true"),t.style.cssText+="\n              text-align: center;\n              margin: 12px auto;\n              width: 90%;\n              max-width: 900px;\n              min-width: 300px;\n            ";const o=n.getBoundingClientRect(),i=n.viewBox?.baseVal?.width||o.width||n.width?.baseVal?.value||800;let l=(n.viewBox?.baseVal?.height||o.height||n.height?.baseVal?.value||600)*((t.clientWidth||.9*e.clientWidth)/i);l>600&&(l=600),n.style.cssText+=`\n              width: 100%;\n              height: ${l}px;\n              max-height: 600px;\n              border: 1px solid #e1e4e8;\n              border-radius: 6px;\n              background: white;\n              cursor: zoom-in;\n              transition: transform 0.2s ease, box-shadow 0.2s ease;\n              display: block;\n              object-fit: contain;\n            `,n.addEventListener("mouseenter",function(){this.style.transform="scale(1.02)",this.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)"}),n.addEventListener("mouseleave",function(){this.style.transform="scale(1)",this.style.boxShadow="none"}),n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),function(e){const t=document.createElement("div");t.className="svg-modal",t.style.cssText="\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: rgba(0, 0, 0, 0.8);\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          z-index: 10000;\n          overflow: hidden;\n        ";const n=document.createElement("div");n.style.cssText="\n          position: relative;\n          width: 90%;\n          height: 90%;\n          overflow: hidden;\n          background: white;\n          border-radius: 8px;\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n          cursor: grab;\n        ";const o=e.cloneNode(!0);o.style.cssText="\n          width: 100%;\n          height: 100%;\n          object-fit: contain;\n          transition: transform 0.1s ease;\n          transform-origin: center center;\n        ",n.appendChild(o),t.appendChild(n);let i=1,l=!1,s=0,c=0,d=0,r=0;function a(){o.style.transform=`translate(${d}px, ${r}px) scale(${i})`}n.addEventListener("wheel",function(e){e.preventDefault();const t=e.deltaY>0?.9:1.1,n=i*t;n>=.5&&n<=5&&(i=n,a())}),n.addEventListener("mousedown",function(e){e.target!==o&&e.target!==n||(l=!0,s=e.clientX-d,c=e.clientY-r,n.style.cursor="grabbing",e.preventDefault())}),document.addEventListener("mousemove",function(e){l&&(d=e.clientX-s,r=e.clientY-c,a())}),document.addEventListener("mouseup",function(){l&&(l=!1,n.style.cursor="grab")});let u=0,h=1;function p(){t.parentNode&&document.body.removeChild(t)}n.addEventListener("touchstart",function(e){if(2===e.touches.length){const t=e.touches[0],n=e.touches[1];u=Math.hypot(n.clientX-t.clientX,n.clientY-t.clientY),h=i}else if(1===e.touches.length){l=!0;const t=e.touches[0];s=t.clientX-d,c=t.clientY-r}e.preventDefault()}),n.addEventListener("touchmove",function(e){if(2===e.touches.length){const t=e.touches[0],n=e.touches[1],o=Math.hypot(n.clientX-t.clientX,n.clientY-t.clientY),l=h*(o/u);l>=.5&&l<=5&&(i=l,a())}else if(1===e.touches.length&&l){const t=e.touches[0];d=t.clientX-s,r=t.clientY-c,a()}e.preventDefault()}),n.addEventListener("touchend",function(){l=!1}),t.addEventListener("click",function(e){e.target===t&&p()});const m=function(e){"Escape"===e.key&&(p(),document.removeEventListener("keydown",m))};document.addEventListener("keydown",m);const g=document.createElement("button");g.innerHTML="×",g.style.cssText="\n          position: absolute;\n          top: 10px;\n          right: 10px;\n          width: 30px;\n          height: 30px;\n          border: none;\n          background: rgba(255, 255, 255, 0.9);\n          color: #333;\n          font-size: 20px;\n          font-weight: bold;\n          border-radius: 50%;\n          cursor: pointer;\n          z-index: 10001;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        ",g.addEventListener("click",function(){p()}),t.appendChild(g),document.body.appendChild(t)}(this)}),n.title="点击放大查看"})})}function r(){if(o&&!t.hasChildNodes()){const e=document.getElementById("vditor-outline")||function(){const e=document.createElement("div");return e.id="vditor-outline",e.className="vditor-outline",e.style.cssText="\n          position: fixed;\n          top: 80px;\n          right: 20px;\n          width: 200px;\n          max-height: 60vh;\n          overflow-y: auto;\n          background: #fff;\n          border: 1px solid #e1e4e8;\n          border-radius: 6px;\n          padding: 10px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          z-index: 1000;\n          font-size: 14px;\n          display: none;\n        ",document.body.appendChild(e),e}();Vditor.preview(t,o,{markdown:{toc:!0,mark:!0,footnotes:!0,autoSpace:!0},math:{engine:"KaTeX",inlineDigit:!0},hljs:{style:"github",lineNumber:!0},mermaid:{enable:!0,theme:"default",cdn:"https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"},anchor:2,lang:"zh_CN",theme:{current:"light"},after:function(){setTimeout(()=>{s(t,e),e.style.display="block"},100),setTimeout(()=>{d(t)},300)}})}}function a(){const e=document.getElementById("vditor-outline"),t=document.getElementById("outlineSwitch");e&&t&&(l=t.checked,e.style.display=l?"block":"none")}if(e){const o=function(){const e=document.createElement("div");e.className="vditor-outline-switch",e.style.display="none";const t=document.createElement("input");t.type="checkbox",t.id="outlineSwitch",t.checked=!0;const n=document.createElement("span");n.className="switch-slider";const o=document.createElement("label");return o.htmlFor="outlineSwitch",o.textContent="大纲",e.appendChild(o),e.appendChild(t),e.appendChild(n),e}(),s=document.querySelector(".vditor-toggle-container");s&&(s.appendChild(o),s.parentNode!==e.parentNode&&e.parentNode.insertBefore(s,e)),n.addEventListener("click",function(){const o=document.getElementById("vditor-outline"),s=document.querySelector(".vditor-outline-switch");i=!i,i?(e.style.display="none",t.style.display="block",n.textContent="显示原文",n.style.backgroundColor="#6c757d",s&&(s.style.display="inline-flex"),o&&l&&(o.style.display="block"),r()):(t.style.display="none",e.style.display="",n.textContent="显示预览",n.style.backgroundColor="#007bff",o&&(o.style.display="none"),s&&(s.style.display="none"))});const c=document.getElementById("outlineSwitch"),d=o.querySelector(".switch-slider"),u=o.querySelector("label");c&&c.addEventListener("change",a),d&&d.addEventListener("click",function(){c.checked=!c.checked,a()}),u&&u.addEventListener("click",function(){c.checked=!c.checked,a()}),e.style.display="none",t.style.display="block",n.textContent="显示原文",n.style.backgroundColor="#6c757d",o.style.display="inline-flex",r()}else n.style.display="none"}},VditorToggle.init())}();